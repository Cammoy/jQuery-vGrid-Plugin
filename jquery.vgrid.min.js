/**
 * jQuery VGrid v0.1.10 - variable grid layout plugin
 *
 * Terms of Use - jQuery VGrid
 * under the MIT (http://www.opensource.org/licenses/mit-license.php) License.
 *
 * Copyright 2009-2012 xlune.com All rights reserved.
 * (http://blog.xlune.com/2009/09/jqueryvgrid.html)
 */
;(function(g){function a(t){var q=t.data("_vgchild");var p=t.width();var w=[[0,p,0]];var u=0,s,r,v;q.each(function(x){s=g(this);if(s.css("display")=="none"){return true;
}r=o(s);v=e(w,r[0]);w=k(w,v,r);u=Math.max(u,v[1]+r[1]);s.data("_vgleft",v[0]);s.data("_vgtop",v[1]);});t.data("_vgwrapheight",u);f(t);}function e(t,s){var u=t.concat().sort(i);
var p=u[u.length-1][2];for(var r=0,q=u.length;r<q;r++){if(u[r][2]>=p){break;}if(u[r][1]-u[r][0]>=s){return[u[r][0],u[r][2]];}}return[0,p];}function k(t,p,s){var u=t.concat().sort(i);
var v=[p[0],p[0]+s[0],p[1]+s[1]];for(var r=0,q=u.length;r<q;r++){if(v[0]<=u[r][0]&&u[r][1]<=v[1]){delete u[r];}else{u[r]=b(u[r],v);}}return d(u,v);}function i(q,p){if(!q||!p){return 0;
}return((q[2]==p[2]&&q[0]>p[0])||q[2]>p[2])?1:-1;}function c(q,p){if(!q||!p){return 0;}return(q[0]>p[0])?1:-1;}function d(t,p){var u=t.concat([p]).sort(c);
var q=[];for(var s=0,r=u.length;s<r;s++){if(!u[s]){continue;}if(q.length>0&&q[q.length-1][1]==u[s][0]&&q[q.length-1][2]==u[s][2]){q[q.length-1][1]=u[s][1];
}else{q.push(u[s]);}}return q;}function b(q,p){if(q[0]>=p[0]&&q[0]<p[1]||q[1]>=p[0]&&q[1]<p[1]){if(q[0]>=p[0]&&q[0]<p[1]){q[0]=p[1];}else{q[1]=p[0];}}return q;
}function o(r){var p=r.width();var q=r.height();p+=Number(r.css("margin-left").replace("px",""))+Number(r.css("padding-left").replace("px",""))+Number(r.get(0).style.borderLeftWidth.replace("px",""))+Number(r.css("margin-right").replace("px",""))+Number(r.css("padding-right").replace("px",""))+Number(r.get(0).style.borderRightWidth.replace("px",""));
q+=Number(r.css("margin-top").replace("px",""))+Number(r.css("padding-top").replace("px",""))+Number(r.get(0).style.borderTopWidth.replace("px",""))+Number(r.css("margin-bottom").replace("px",""))+Number(r.css("padding-bottom").replace("px",""))+Number(r.get(0).style.borderBottomWidth.replace("px",""));
return[p,q];}function f(q){var p=q;var r=p.data("_vgchild").length*(p.data("_vgopt").delay||0)+p.data("_vgopt").time||500;p.stop(false,true);if(p.height()<p.data("_vgwrapheight")){if(!g.support.noCloneEvent){p.height(p.data("_vgwrapheight"));
}else{p.animate({height:p.data("_vgwrapheight")+"px"},(p.data("_vgopt").time||500),"easeOutQuart");}}else{clearTimeout(p.data("_vgwraptimeout"));p.data("_vgwraptimeout",setTimeout(function(){if(!g.support.noCloneEvent){p.height(p.data("_vgwrapheight"));
}else{p.animate({height:p.data("_vgwrapheight")+"px"},(p.data("_vgopt").time||500),"easeOutQuart");}},r));}}function n(q){var p;q.each(function(r){p=g(this);
p.css("left",p.data("_vgleft")+"px");p.css("top",p.data("_vgtop")+"px");});}function m(v,u,p,s){var w=g(v).parent();var x=false;var q=v.length;var r,t,y;
for(r=0;r<q;r++){t=g(v[r]);y=t.position();if(y.left!=t.data("_vgleft")||y.top!=t.data("_vgtop")){x=true;}}if(x){if(typeof(w.data("_vgopt").onStart)=="function"){w.data("_vgopt").onStart();
}v.each(function(A){var z=g(this);var B={duration:p,easing:u};if(v.size()-1==A){B.complete=w.data("_vgopt").onFinish||null;}clearTimeout(z.data("_vgtimeout"));
z.data("_vgtimeout",setTimeout(function(){z.animate({left:z.data("_vgleft")+"px",top:z.data("_vgtop")+"px"},B);},A*s));});}}function h(p){p.each(function(r){var q=g(this);
clearTimeout(q.data("_vgtimeout"));q.data("_vgtimeout",setTimeout(function(){a(q);m(q.data("_vgchild"),q.data("_vgopt").easing||"linear",q.data("_vgopt").time||500,q.data("_vgopt").delay||0);
},500));});}function l(p,r){var q=g("<span />").text(" ").attr("id","_vgridspan").hide().appendTo("body");q.data("size",q.css("font-size"));q.data("timer",setInterval(function(){if(q.css("font-size")!=q.data("size")){q.data("size",q.css("font-size"));
r(p);}},1000));}function j(p,r){if(!p.data("vgrid-image-event-added")){p.data("vgrid-image-event-added",1);p.bind("vgrid-added",function(){p.find("img").each(function(){var t=g(this);
if(!t.data("vgrid-image-handler")){t.data("vgrid-image-handler",1);t.bind("load",function(){r(p);});}});});}p.trigger("vgrid-added");var q=p.append;var s=p.prepend;
p.append=function(){q.apply(p,arguments);p.trigger("vgrid-added");};p.prepend=function(){s.apply(p,arguments);p.trigger("vgrid-added");};}g.fn.extend({vgrid:function(r){var p=g(this);
var q=r||{};if(q.easeing){q.easing=q.easeing;}p.each(function(){var s=g(this);s.data("_vgopt",q);s.data("_vgchild",s.find("> *"));s.data("_vgdefchild",s.data("_vgchild"));
s.css({position:"relative",width:"auto"});s.data("_vgchild").css("position","absolute");a(s);n(s.data("_vgchild"));if(s.data("_vgopt").fadeIn){var t=(typeof(s.data("_vgopt").fadeIn)=="object")?s.data("_vgopt").fadeIn:{time:s.data("_vgopt").fadeIn};
s.data("_vgchild").each(function(v){var u=g(this);if(u.css("display")=="none"){return true;}u.stop(false,true).css({opacity:0});setTimeout(function(){u.stop(false,true).fadeTo(t.time||250,1);
},v*(t.delay||0));});}g(window).resize(function(u){h(s);});if(q.useLoadImageEvent){j(s,h);}if(q.useFontSizeListener){l(s,h);}});return p;},vgrefresh:function(t,s,q,r){var p=g(this);
p.each(function(){var v=g(this);var u=v.data("_vgopt")||{};if(v.data("_vgchild")){v.data("_vgchild",v.find("> *"));v.data("_vgchild").css("position","absolute");
a(v);s=typeof(s)=="number"?s:v.data("_vgopt").time||500;q=typeof(q)=="number"?q:v.data("_vgopt").delay||0;m(v.data("_vgchild"),t||v.data("_vgopt").easing||"linear",s,q);
if(typeof(r)=="function"){setTimeout(r,v.data("_vgchild").length*q+s);}}if(u.useLoadImageEvent){j(v,h);}});return p;},vgsort:function(r,t,s,q){var p=g(this);
p.each(function(){var u=g(this);if(u.data("_vgchild")){u.data("_vgchild",u.data("_vgchild").sort(r));u.data("_vgchild").each(function(v){g(this).appendTo(u);
});a(u);m(u.data("_vgchild"),t||u.data("_vgopt").easing||"linear",typeof(s)=="number"?s:u.data("_vgopt").time||500,typeof(q)=="number"?q:u.data("_vgopt").delay||0);
}});return p;}});})(jQuery);